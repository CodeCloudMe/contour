<!doctype html>
<html>
<head>

    <link rel="stylesheet" href="docs.css">

    <script>exports = window; </script>
    <script src="http://code.jquery.com/jquery-1.10.2.min.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/underscore.js/1.5.2/underscore-min.js"></script>
    <script src="markdown.js"></script>

</head>
<body>

<h1>Narwhal Documentation</h1>

<nav id="main">
</nav>
<div id="content"></div>

<script>


var main = [
    { key: 'Overview', path: 'overview.md' },
    { key: 'QuickStart', path: 'quickstart.md'},    
    { key: 'Example Visualizations', path: '../examples/index.html'},
    { key: 'Example Extensions', path: '../examples/extensions.html'},
    { key: 'Key Concepts', path: 'key_concepts.md'},
    { key: 'Supported Data Formats', path: 'supported_data_formats.md'},    
    { key: '&nbsp;', path: ''},
    { key: 'Narwhal', path: 'narwhal.js.md' },
    { key: 'cartesian', path: 'cartesian.js.md' },
    { key: 'horizontal', path: 'horizontal-frame.js.md' },
    { key: 'line', path: 'line.js.md' },
    { key: 'bar', path: 'bar.js.md' },
    { key: 'area', path: 'area.js.md' },
    { key: 'column', path: 'column.js.md' },
    { key: 'pie', path: 'pie.js.md' },
    { key: 'scatter', path: 'scatter.js.md' },
    { key: 'trendLine', path: 'trend-line.js.md' },
    { key: 'tooltip', path: 'tooltip.js.md' },
    { key: 'stackTooltip', path: 'stack-tooltip.js.md' },
];

var navLITemplate = '<li class="nav-element" data-path="<%= path %>"><%= key %></li>';

$.getJSON('./config/menu.json', constructMenu);



function constructMenu(data) {
    var ul = $('<ul>');

    _.each(main, function(e) {
        ul.append(_.template(navLITemplate)(e));
    });

    build(data, ul);
    ul.appendTo($('nav'));

    $('nav').on('click', 'li[data-path]', function () {
        var path = $(this).attr('data-path');
        $.ajax({
            type:'GET',
            url: path,
            success: function (md) {
                $('#content').html(Markdown.toHTML(md))
                //$('#content').html(md)
            }
        })

    })
}

function build(data, container) {
    for(var key in data) {
        if(!key) continue;
        if (key !== 'path') {
            var dataPath = data[key].path ? 'data-path="config/'+data[key].path + '"' : '';
            if (key == 'config') { dataPath = 'data-path="config/config.md"'; }
            container.append(['<li class="nav-element" '+ dataPath +'>', key, '</li>'].join(''))
        }

        if(typeof data[key] === 'object') {
            var ul = $('<ul>').appendTo(container);
            build(data[key], ul);
        }
    }
}


</script>

</body>

</html>
