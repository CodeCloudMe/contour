/*! Narwhal - v0.0.1 - 2013-10-29 */
!function(a,b,c,d,e){function f(a){return this.init(a),this}var g={chart:{animations:!1,defaultWidth:400,defaultAspect:1/1.61803398875,width:e,height:e,margin:{top:0,right:0,bottom:0,left:0},padding:{top:0,right:0,bottom:0,left:0}}};f.export=function(a,b){if("function"!=typeof b)throw new Error("Invalid render function for "+a+" visualization");f.prototype[a]=function(e,f){e=e||[],b.defaults=b.defaults||{};var g={};g[a]=f,d.extend(!0,this.options,b.defaults,g),this.data(e);var h=c.map(e,c.bind(this.datum,this));return this.visualizations.push(c.partial(b,h)),this}},f.utils={textBounds:function(a,b){var c=document.getElementsByTagName("body")[0],d=document.createElement("span"),e=document.createElement("span");d.className="narwhal-chart",e.style.position="absolute",e.style.left=-9999,e.innerHTML=a,e.className=b,d.appendChild(e),c.appendChild(d);var f={width:e.clientWidth,height:e.clientHeight};return e.remove(),d.remove(),f}},f.prototype=c.extend(f.prototype,{init:function(a){return this.options=a,this.visualizations=[],this},calculateWidth:function(){return parseInt(d(this.options.el).width(),10)||this.options.chart.defaultWidth},calculateHeight:function(){var a=parseInt(d(this.options.el).height(),10),b=this.options.chart.width,c=this.options.chart.aspect||this.options.chart.defaultAspect;return a?a:Math.round(b*c)},calcMetrics:function(){var a=this.options;a.chart.width=a.chart.width||this.calculateWidth(),a.chart.height=a.chart.height||this.calculateHeight(),this.options=d.extend(!0,a,{chart:{plotWidth:a.chart.width-a.chart.margin.left-a.chart.margin.right-a.chart.padding.left-a.chart.padding.right,plotHeight:a.chart.height-a.chart.margin.top-a.chart.margin.bottom-a.chart.padding.top-a.chart.padding.bottom}})},composeOptions:function(){this.options=d.extend(!0,{},g,this.options)},baseRender:function(){return this.plotArea(),this},render:function(){return this.composeOptions(),this.calcMetrics(),this.baseRender(),this.renderVisualizations(),this},plotArea:function(){var a=this.options.chart;return this.container=b.select(this.options.el),this.svg=this.container.append("svg").attr("viewBox","0 0 "+a.width+" "+a.height).attr("preserveAspectRatio","xMinYMin").attr("class","narwhal-chart").append("g").attr("transform","translate("+a.margin.left+","+a.margin.top+")"),this},createVisualizationLayer:function(a){return this.svg.append("g").attr("vis-id",a).attr("transform","translate("+this.options.chart.padding.left+","+this.options.chart.padding.top+")")},renderVisualizations:function(){return c.each(this.visualizations,function(a,b){var c=b+1,d=this.createVisualizationLayer(c);a.call(this,d,this.options,c)},this),this},expose:function(a,b){var d={},e=function(){return c.extend(this,c.omit(b,"init")),b.init&&b.init.call(this,this.options),this};return d[a]=e,c.extend(this,d),this},compose:function(){},data:function(){}}),window[a]=f}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c,d,e){function f(a,b){return"number"==typeof a&&(a=[a]),"number"==typeof b&&(b=[b]),a&&a.length?b&&b.length?[].concat(a,b).sort(function(a,b){return a-b}):a:b}function g(a){return Math.ceil(1.1*a)}function h(a,b,d){var f=c.max(a),g=c.min(a);return b===e&&d===e?[g,f]:b===e?[Math.min(g,d),d]:d===e?[b,Math.max(b,f)]:[b,d]}var i={chart:{padding:{top:3,bottom:25,left:40,right:3}},xAxis:{rangePadding:0,innerTickSize:0,outerTickSize:0,tickPadding:6,titlePadding:0,firstAndLast:!0},yAxis:{min:0,max:e,innerTickSize:6,outerTickSize:6,tickPadding:4,titlePadding:0,labels:{format:"s"}}},j={dataSrc:[],init:function(a){return this.options=d.extend(!0,{},i,a),(this.options.xAxis.title||this.options.yAxis.title)&&(this.titleOneEm=Narwhal.utils.textBounds("ABCD","axis-title").height,this.options.xAxis.title&&(this.options.chart.padding.bottom+=this.titleOneEm),this.options.yAxis.title&&(this.options.chart.padding.left+=this.titleOneEm)),this},computeXScale:function(){if(!this.xDomain)throw new Error("You are trying to render without setting data (xDomain).");this.scaleGenerator=c.nw.xScaleFactory(this.dataSrc,this.options),this.xScale=this.scaleGenerator.scale(this.xDomain),this.rangeBand=this.scaleGenerator.rangeBand()},computeYScale:function(){if(!this.yDomain)throw new Error("You are trying to render without setting data (yDomain).");var a=h(this.yDomain,this.options.yAxis.min,this.options.yAxis.max);this.yScale=b.scale.linear().domain(a).range([this.options.chart.plotHeight,0])},computeScales:function(){return this.adjustDomain(),this.computeXScale(),this.computeYScale(),this},xAxis:function(){var a=this.options.chart.plotHeight+this.options.chart.padding.top,b=this.scaleGenerator.axis().orient("bottom");return this._xAxisGroup=this.svg.append("g").attr("class","x axis").attr("transform","translate("+this.options.chart.padding.left+","+a+")").call(b),this.scaleGenerator.postProcessAxis(this._xAxisGroup),this},yAxis:function(){var a=this.options.yAxis,c=this._extractTickValues(this.yDomain,a.min,a.max),d=b.format(a.labels.format),e=b.svg.axis().scale(this.yScale).tickValues(c).tickFormat(d).tickSize(a.innerTickSize,a.outerTickSize).tickPadding(a.tickPadding).orient("left");return this._yAxisGroup=this.svg.append("g").attr("class","y axis").attr("transform","translate("+this.options.chart.padding.left+","+this.options.chart.padding.top+")"),this._yAxisGroup.call(e).selectAll("text").attr("dy",".9em"),this},axisLabels:function(){var a=.25*this.titleOneEm;this.options.xAxis.title&&this._xAxisGroup.append("text").attr("class","x axis-title").attr("text-anchor","end").attr("y",this.options.chart.padding.bottom-a).attr("dx",this.options.chart.plotWidth).attr("dy",-this.options.xAxis.titlePadding).text(this.options.xAxis.title),this.options.yAxis.title&&this._yAxisGroup.append("text").attr("class","y axis-title").attr("text-anchor","end").attr("transform","rotate(-90)").attr("y",-this.options.chart.padding.left+this.titleOneEm-a).attr("dx",0).attr("dy",this.options.yAxis.titlePadding).text(this.options.yAxis.title)},render:function(){return this.composeOptions(),this.calcMetrics(),this.computeScales(),this.baseRender(),this.xAxis().yAxis().axisLabels(),this.renderVisualizations(),this},datum:function(a,b){return{y:c.isObject(a)?a.y:a,x:c.isObject(a)?a.x:this.options.xAxis.categories?this.options.xAxis.categories[b]:b}},data:function(a){return a instanceof Array&&!a.length?this:(a instanceof Array&&!a[0].data?(this.dataSrc=c.map(a,c.bind(this.datum,this)),this.xDomain=this.extractXDomain(this.dataSrc),this.yDomain=this.extractYDomain(this.dataSrc),this.yMax=this.getYAxisDataMax(this.dataSrc),this.yMin=this.getYAxisDataMin(this.dataSrc)):a instanceof Array&&a[0].data&&c.each(a,function(a){this.data(a.data)},this),this)},getYAxisDataMax:function(a){return Math.max(this.yMax||0,c.max(c.pluck(a,"y")))},getYAxisDataMin:function(a){return Math.min(this.yMin||0,c.min(c.pluck(a,"y")))},extractXDomain:function(a){return this.options.xAxis.categories?this.options.xAxis.categories:c.pluck(a,"x")},extractYDomain:function(a){var b=this.yDomain?Math.max(this.yDomain[1],c.max(c.pluck(a,"y"))):c.max(c.pluck(a,"y")),d=this.yDomain?Math.min(this.yDomain[0],c.min(c.pluck(a,"y"))):c.min(c.pluck(a,"y"));return[d,b]},adjustDomain:function(){this.yDomain=this.yDomain?[this.yDomain[0],g(this.yDomain[1])]:[0,10],this.xDomain=this.xDomain?this.xDomain:[]},_extractTickValues:function(a,b,c){var d=f(a,this.yMax);return b===e&&c===e?d:b===e?c>this.yMin?f([c],d):[c]:c===e?b>=this.yMax?[b]:(d[0]=b,d):f([b,c],this.yMax)}};window[a].prototype.expose("cartesian",j)}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c){var d={xScaleFactory:function(a,b){var d=c.isArray(a)&&a.length>0&&a[0].data?a[0].data[0].x&&c.isDate(a[0].data[0].x):c.isArray(a)&&a.length>0&&a[0].x&&c.isDate(a[0].x);return d&&"ordinal"!==b.xAxis.type?new c.nw.TimeScale(a,b):new c.nw.OrdinalScale(a,b)}};c.nw=c.extend({},c.nw,d)}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c){function d(a,b){this.options=b,this.data=a,this.init()}d.prototype={init:function(){this.isCategorized=!0,delete this._scale},scale:function(a){return this._domain=a,this._scale||(this._scale=(new b.scale.ordinal).domain(a),this.range()),this._scale},axis:function(){var a=this.options.xAxis,d=b.svg.axis().scale(this._scale).innerTickSize(a.innerTickSize).outerTickSize(a.outerTickSize).tickPadding(a.tickPadding).tickValues(this.options.xAxis.categories).tickFormat(function(a){return c.isDate(a)?a.getDate():a});return this.options.xAxis.firstAndLast&&d.tickValues(c.nw.firstAndLast(this._domain)),d},postProcessAxis:function(){},rangeBand:function(){return this._scale.rangeBand()},range:function(){var a=[0,this.options.chart.plotWidth];return this.isCategorized?this._scale.rangeRoundBands(a,.1):this._scale.rangePoints(a)}},c.nw=c.extend({},c.nw,{OrdinalScale:d})}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c,d,e){function f(a,b){this.options=b,this.data=a}f.prototype={init:function(){delete this._scale},scale:function(a){return this._domain=a,this._scale||(this._scale=(new b.time.scale).domain(b.extent(a)),this.range()),this._scale},axis:function(){var a=this.options.xAxis,d=this.getOptimalTickFormat(),e=b.svg.axis().scale(this._scale).tickFormat(d).innerTickSize(a.innerTickSize).outerTickSize(a.outerTickSize).tickPadding(a.tickPadding).tickValues(this._domain);return this.options.xAxis.firstAndLast&&e.tickValues(c.nw.firstAndLast(this._domain)),e},postProcessAxis:function(a){var b=a.selectAll(".tick text")[0];d(b[0]).attr("style","text-anchor: start"),d(b[b.length-1]).attr("style","text-anchor: end")},rangeBand:function(){return 4},getOptimalTickFormat:function(){return b.time.format("%d %b")},getOptimalTicks:function(){return b.time.days},range:function(){return this._scale.rangeRound([0,this.options.chart.plotWidth],.1)},extractDomain:function(a,c,d){return c===e&&d===e?b.extent(a):c===e?[Math.min(a[0],d),d]:d===e?[c,Math.max(c,a[a.length-1])]:[c,d]}},c.nw=c.extend({},c.nw,{TimeScale:f})}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c){var d={firstAndLast:function(a){return[a[0],a[a.length-1]]}};c.nw=c.extend({},c.nw,d)}("Narwhal",window.d3,window._,window.jQuery),function(){function a(a,b,c,d){var e=this.options.chart.plotHeight,f=this.xScale,g=this.yScale,h=this.rangeBand,i=this.options.yAxis.min||this.yMin,j=b.selectAll(".column").data(a);if(j.enter().append("rect").attr("class","bar vis-"+d).attr("x",function(a){return f(a.x)}).attr("y",function(){return g(i)}).attr("height",0).attr("width",function(){return h}),this.options.chart.animations){var k=3;j.transition().delay(function(a,b){return b*k}).duration(500).attr("height",function(a){return e-g(a.y)}).attr("y",function(a){return g(a.y)})}else j.attr("height",function(a){return e-g(a.y)}).attr("y",function(a){return g(a.y)})}var b={};a.defaults=b,Narwhal.export("column",a)}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c){function d(a,d,e,f){function g(a,c,e){function g(){var c=a,d=b.scale.quantile().domain([0,1]).range(b.range(1,c.length+1));return function(a){return j(c.slice(0,d(a)))}}var k=this.options.line.marker.size;c=c||"s-"+e,className=c.replace(" ","_")+" v-"+f;var l=d.append("path").datum(a).attr("class","line "+className);this.options.chart.animations?l.attr("d",j(a[0])).transition().duration(600).attrTween("d",g):l.attr("d",j),this.options.line.marker.enable&&d.append("g").attr("class","line-chart-markers").selectAll("dot").data(a).enter().append("circle").attr("class","dot tooltip-tracker series-"+className).attr("r",k).attr("cx",h).attr("cy",i)}var h=c.bind(function(a){return this.xScale(a.x)+this.rangeBand/2},this),i=c.bind(function(a){return this.yScale(a.y)},this),j=b.svg.line().x(function(a){return h(a)}).y(function(a){return i(a)}),k=c.bind(this.datum,this);return a[0].data?c.each(a,function(a,b){var d=c.map(a.data,k);g.call(this,d,a.name,b+1)},this):g.call(this,c.map(a,k),a.name,1),this}var e={line:{marker:{enable:!0,size:2.5}}};d.defaults=e,Narwhal.export("line",d)}("Narwhal",window.d3,window._,window.jQuery),function(a,b,c){function d(a,b){return b="undefined"==typeof b?!0:b,this.parse(a,b),this._dimension=0,this}d.prototype={parse:function(a,b){if(this._data=[],this._headers=[],a&&a.length){var d=a.split(/\n\r?/);this._headers=b?c.each(d.shift().split(","),function(a){return a.toLowerCase()}):c.range(0,d[0].length),c.each(d,function(a){this._data.push(a.split(","))},this)}},dimension:function(a){return arguments.length?(this._dimension=this._headers.indexOf(a.toLowerCase()),this):this._headers[this._dimension]},measure:function(a){return this.data(a.toLowerCase())},data:function(a){var b=this._dimension,d=this._headers.indexOf(a),e=c.map(this._data,function(a){return{x:a[b],y:c.isNaN(+a[d])?a[d]:+a[d]}});return e}},Narwhal.connectors=Narwhal.connectors||{},Narwhal.connectors.Csv=d}("Narwhal",window.d3,window._,window.jQuery);
//# sourceMappingURL=dist/narwhal.min.map