<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Example on How to User Narwhal</title>
    <link rel="stylesheet" href="../examples/css/bootstrap.min.css">
    <link rel="stylesheet" href="../examples/css/narwhal.css">

    <script src="../examples/js/vendor/d3.js"></script>

    <script src="../examples/js/vendor/lodash.js"></script>

    <script src="../src/scripts/core/narwhal-utils.js" ></script>
    <script src="../src/scripts/core/axis/ordinal-scale-axis.js" ></script>
    <script src="../src/scripts/core/axis/time-scale-axis.js" ></script>
    <script src="../src/scripts/core/axis/linear-scale-axis.js" ></script>
    <script src="../src/scripts/core/axis/y-axis.js" ></script>
    <script src="../src/scripts/core/axis/smart-y-axis.js" ></script>
    <script src="../src/scripts/core/axis/log-y-axis.js" ></script>
    <script src="../src/scripts/core/axis/axis-scale-factory.js" ></script>
    <script src="../src/scripts/core/narwhal.js"></script>
    <script src="../src/scripts/core/visualization-container.js"></script>
    <script src="../src/scripts/core/cartesian.js"></script>
    <script src="../src/scripts/core/horizontal-frame.js"></script>
    <script src="../src/scripts/visualizations/line.js"></script>
    <script src="../src/scripts/visualizations/area.js"></script>
    <script src="../src/scripts/visualizations/tooltip.js"></script>
    <script src="../src/scripts/visualizations/stack-tooltip.js"></script>
    <script src="../src/scripts/visualizations/column.js"></script>
    <script src="../src/scripts/visualizations/bar.js"></script>
    <script src="../src/scripts/visualizations/pie.js"></script>
    <script src="../src/scripts/visualizations/scatter.js"></script>
    <script src="../src/scripts/visualizations/cool-narwhal.js"></script>
    <script src="../src/scripts/visualizations/trend-line.js"></script>


    <style>
        .chart {
            width: 400px;
/*            height: 300px;
            width: 400px;*/
            margin: 10px 0;
        }

        .chart svg {
            border: solid 0px red;

        }


        .legend {
            height: 1.5em;
        }


        .s-2 {
            opacity: .7
        }

        .grid-line {
            stroke-dasharray: 5,5
        }

        .xyz, .www {
            opacity: 0.4;
        }


    </style>

</head>
<body>

<div class="container">
    <h2>Narwhal</h2>

    <div class="legend"></div>
    <div class="chart"></div>
    <div id="res"></div>


</div>
<script>


var series = [];

var rand = function (num) {
    return Math.round(Math.random() * num);
}

var generateSeries = function (numSeries) {
    numSeries = numSeries || 1;
    var numPoints = 100;
    var series = [];
    for(var i=0, seriesData = []; i<numSeries; i++) {
        series.push({
            name: 'S' + (i+1),
            data: seriesData
        });

       for(var j=0; j<numPoints; j++) {
            seriesData.push({ x: rand(10) + 200, y: rand(100) });
        }

        seriesData = seriesData.sort(function(a,b) {
            return a.x - b.x;
        });
    }

    return series;
}



var config = {

    el: '.chart',
    chart: {
        gridlines: 'none',
    },

    xAxis: {
        firstAndLast: false,
        innerTickSize: 5,
        outerTickSize: 3,
        // categories: [1,2,3,4,5,6,7],

        labels: {
            format: '0.1f',
        }

    },

    yAxis: {
        // smartAxis: false,
        // nicing: false,

        // tickValues: [10, 20, 100, 140, 150],
        // max:150,
        labels: {
            format: ',.0f'

            // formatter: function (d) { return 'a' }
        },
        title: 'Values'
    },

    column: {
        stacked: false
    },

    tooltip: {
        // formatter: function (d) {
        //     return d.data.x + '<br>' + d.data.y;
        // }
    },

};


Narwhal.export('col', function (data, layer, options) {
    var w = options.chart.plotWidth;
    var h = options.chart.plotHeight;
    var x = this.xScale;
    var y = this.yScale;
    var clamp = function (val, l, h) { return val > h ? h : val < l ? l : val; };
    var clampLeft = function (val, low) { return val < low ? low : val; };
    var clampRight = function (val, high) { return val > high ? high : val; };

    var g = layer.attr('class', 'series s-1');
    update.call(this, data);

    function update(data) {
        var duration = 400;
        var dataKey = function (datum) { return datum.x };
        var cats = options.xAxis.categories;
        var rangeBand = this.rangeBand;

        // x.domain(_.map(data, function (d, i) { return cats[i]; }));
        // y.domain([0, d3.max(data[0].data, function(d) { return d.y; })]);


        // svg.select('.x.axis').transition().duration(duration).call(xAxis)
        // this.svg.select('.y.axis').transition().duration(duration).call(this.yAxis())

        var bars = g.selectAll('.column')
            .data(data[0].data, dataKey);

        bars.enter()
            .append('rect')
            .attr('class', function(d, i) { return  'column ' + i; })
            .attr('x', function (d, i) {
                return x(d.x) + 0.5;
            })
            .attr('width', rangeBand + 0.5)
            .attr('y', clampLeft(h  - 0.5, 0))
            .attr('height', 0)

        bars.transition().duration(duration)
            // .attr('data-value-y', function (d) { return d.y; })
            // .attr('data-value-x', function (d) { return d.x; })
            .attr('x', function (d, i) {
                return x(d.x);
            })
            .attr('y', function (d) { return y(d.y) + 0.5; })
            .attr('width', rangeBand + 0.5)
            .attr('height', function(d) {
                return clampLeft(h-y(d.y) - 0.5, 0);
            });


        bars.exit()
            .transition().duration(duration)
            .attr('y', h)
            .attr('height', 0)
            .remove();

    }

})


var data = [
    { name: 'abc', data: [1, 2, 3, 4, 5, 4, 3, 2, 1]},
    // { name: 'xxx', data: [3,2,1]}
    ]


// data = [
// { x: new Date(2013, 1, 1), y: 100 },
// { x: new Date(2013, 1, 2), y: 120 },
// { x: new Date(2013, 1, 3), y: 130 },
// { x: new Date(2013, 1, 4), y: 110 },
// ]




var chart = new Narwhal(config)
    .cartesian()
    .col(data)
    // .pie([{ x: 'Alpha', y: 10}, { x: 'Beta', y: 30}, {x: 'Gamma', y: 40}, {x: 'Kappa', y: 20}])
    .tooltip()
    .render();





</script>
</body>
</html>
